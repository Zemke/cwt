<h1>Playoffs Draw</h1>
<p class="lead mb-4">
    Participants from the first branch can only clash with those of the second branch in the finale at the earliest. For instance,
    you might want to put the last yearâ€™s finalists into separate branches.<br>
    Other than that, subsequent games would be matched sequentially. That means by way of example, in the first branch the winner
    of the first game will play against the winner of the second game in that same branch and so on.<br>
    For your orientation when doing the draw, follow the pots of the users advancing from the group stage by their position they
    ended up with in the group stage.
</p>

<div class="card-deck">
    <div *ngFor="let pot of numberOfGroupMembersAdvancingIterable" class="card my-1 my-sm-0">
        <div class="card-body">
            <h4 class="card-title">Place {{pot + 1}}</h4>
            <p class="card-text">
                <span *ngFor="let group of groups; let last = last;">
                    <span *ngFor="let standing of group.standings | cwtStandingsOrder; let index = index">
                        <span *ngIf="index === pot">
                            <a [routerLink]="['/user', standing.user.id]">{{standing.user.username}}</a>{{last ? '' : ', '}}
                        </span>
                    </span>
                </span>
            </p>
        </div>
    </div>
</div>

<hr>

<form #playoffDrawForm="ngForm" class="mt-4" (submit)="submit()">
    <div class="row" *ngIf="games">
        <div *ngFor="let branchNum of [0, 1];" class="col-lg-6">
            <h2 class="mt-lg-0 mt-2">{{branchNum === 0 ? 'First' : 'Second'}} Branch</h2>
            <div class="form-row py-2" [ngClass]="{'bg-light': even}"
                 *ngFor="let game of (branchNum === 0 ? firstBranchGames : secondBranchGames); let index = index; let even = even;">
                <div class="col-12 col-sm-6">
                    <input class="form-control" required placeholder="Home" [(ngModel)]="game.homeUser"
                           name="{{'gameHomeUserRound1Spot' + game.playoff.spot}}" [editable]="false"
                           [ngClass]="{'is-invalid': playoffDrawForm.control.controls['gameHomeUserRound1Spot' + game.playoff.spot]?.invalid && playoffDrawForm.control.controls['gameHomeUserRound1Spot' + game.playoff.spot]?.touched}"
                           [ngbTypeahead]="typeAheadForPlayoffsUser" [inputFormatter]="typeAheadInputFormatter"
                           [resultFormatter]="typeAheadResultFormatter">
                </div>
                <div class="col-12 col-sm-6 mt-1 mt-sm-0">
                    <input class="form-control" required placeholder="Away" [(ngModel)]="game.awayUser"
                           name="{{'gameAwayUserRound1Spot' + game.playoff.spot}}" [editable]="false"
                           [ngClass]="{'is-invalid': playoffDrawForm.control.controls['gameAwayUserRound1Spot' + game.playoff.spot]?.invalid && playoffDrawForm.control.controls['gameAwayUserRound1Spot' + game.playoff.spot]?.touched}"
                           [ngbTypeahead]="typeAheadForPlayoffsUser" [inputFormatter]="typeAheadInputFormatter"
                           [resultFormatter]="typeAheadResultFormatter">
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-md-12">
            <div class="form-check">
                <label class="form-check-label">
                    <input type="checkbox" class="form-check-input" required [(ngModel)]="confirm" name="agreeToRuleconfirms">
                    I have reviewed the draw.
                </label>
            </div>
            <button class="btn btn-primary"
                    [disabled]="!playoffDrawForm.form.valid">
                Draw Playoffs
            </button>
        </div>
    </div>
</form>

<pre>{{games | json}}</pre>
